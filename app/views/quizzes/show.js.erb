  // add array index of for old browsers (IE<9)
  if (!Array.prototype.indexOf) {
    Array.prototype.indexOf = function(obj, start) {
      var i, j;
      i = start || 0;
      j = this.length;
      while (i < j) {
        if (this[i] === obj) {
          return i;
        }
        i++;
      }
      return -1;
    };
  }

  var QuizGenerator = {};

  var processedScripts = [];

  var styleTags = [];

  var scriptTags = document.getElementsByTagName('script');
  var thisRequestUrl = '<%= raw(request.url) %>';

  for(var i = 0; i < scriptTags.length; i++) {
    var scriptTag = scriptTags[i];

    // src matches the url of this request, and not processed it yet.
    if (scriptTag.src == thisRequestUrl && processedScripts.indexOf(scriptTag) < 0) {

      processedScripts.push(scriptTag);

      // add the style tag into the head (once only)
      if(styleTags.length == 0) {
        // add a style tag to the head
        var styleTag = document.createElement("link");
        styleTag.rel = "stylesheet";
        styleTag.type = "text/css";
        styleTag.href =  'http://localhost:3000/assets/cleanslate.css';
        styleTag.media = "all";
        document.getElementsByTagName('head')[0].appendChild(styleTag);
        styleTags.push(styleTag);
      }

	  var div = document.createElement('div');
	  div.id = 'embedded_quiz';
	  div.className = 'embedded_quiz cleanslate';
      scriptTag.parentNode.insertBefore(div, scriptTag);
      div.innerHTML='<%= j(render("embed", quiz: @quiz)) %>';
      embedQuiz('<%= raw(@quiz.to_json) %>', '<%= raw(@questions.to_json) %>', '<%= raw(@answers.to_json) %>' );
    }
  }